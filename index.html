<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Music club</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
</head>
<body>
  <header>
    <div class="container">
    </div>
  </header>
  <main>
    <div class="click-counter">
      <p>Количество кликов: <span id="click-count">0</span></p>
      <button id="click-button">Click Me!</button>
    </div>
    <div class="music-player">
      <button id="get-audio-button">Получить список аудиозаписей</button>
      <ul id="audio-list"></ul>
      <audio id="audio-player" controls></audio>
    </div>
  </main>
  <footer></footer>
  <script>
    // Инициализация VK Bridge
    vkBridge.send('VKWebAppInit');

    let clickCount = 0;
    const countDisplay = document.getElementById('click-count');
    const clickButton = document.getElementById('click-button');
    clickButton.addEventListener('click', () => countDisplay.textContent = ++clickCount);

    const getAudioButton = document.getElementById('get-audio-button');
    const audioList = document.getElementById('audio-list');
    const audioPlayer = document.getElementById('audio-player');

    getAudioButton.addEventListener('click', () => {
      // Запрос токена доступа
      vkBridge.send('VKWebAppGetAuthToken', {
        app_id: 52166766,
        scope: 'audio'
      })
      .then(data => {
        if (data.access_token) {
          //ка аудиозаписей
          return vkBridge.send('VKWebAppCallAPIMethod', {
            method: 'audio.get',
            params: {
              access_token: data.access_token,
              v: '5.131'
            }
          });
        } else {
          throw new Error('Не удалось получить токен доступа');
        }
      })
      .then(audioData => {
        // Отображение списка аудиозаписей
        audioList.innerHTML = '';
        audioData.response.items.forEach(audio => {
          const li = document.createElement('li');
          li.textContent = `${audio.artist} - ${audio.title}`;
          li.addEventListener('click', () => {
            audioPlayer.src = audio.url;
            audioPlayer.play();
          });
          audioList.appendChild(li);
        });
      })
      .catch(error => {
        console.error('Ошибка:', error);
        alert('Произошла ошибка при получении аудиозаписей');
      });
    });
  </script>
</body>
</html>
